# ë©€í‹°í”Œë ˆì´ì–´ ê²Œì„ ê°œë°œ

## ê¸°ëŠ¥ ì„¤ëª…

1. ë°© êµ¬ì¡°
  - ë°©ì„ ìƒì„±í•˜ê³  ì°¸ê°€í•  ìˆ˜ ìˆë‹¤.
  - ë°©ì— ë“¤ì–´ê°€ë©´ ê°™ì€ ë°©ì— ìˆëŠ” ìœ ì €ë“¤ë§Œ ë³¼ ìˆ˜ ìˆë‹¤.
  - ìµœëŒ€ ì¸ì›ì€ 2ëª…ì´ê³ , ìµœëŒ€ ì¸ì›ì„ ë‹¤ ì±„ìš°ë©´ ê·¸ ë°©ì€ ë“¤ì–´ê°ˆ ìˆ˜ ì—†ìœ¼ë©°, ë¡œë¹„ì—ì„œ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë°©ì˜ ìƒíƒœê°€ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€í•œë‹¤.
  - ì„œë²„ ìƒì„±ê³¼ í•¨ê»˜ ë°©ì„ í•˜ë‚˜ ë§Œë“¤ê¸° ë•Œë¬¸ì— ì•„ë¬´ë„ ì—†ëŠ” ë°©ì´ í•˜ë‚˜ ìˆë‹¤.
  - ë°©ì„ ë§Œë“¤ë©´ ë°”ë¡œ ê·¸ ë°©ì— ì ‘ì†í•˜ê²Œ ëœë‹¤.
  - ë‹¤ë¥¸ ì‚¬ëŒì€ ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ê·¸ ë°©ì— ì ‘ì†í•  ìˆ˜ ìˆë‹¤.
  - ë°© ì•ˆì˜ ë§ˆì§€ë§‰ ìœ ì €ê°€ ë°©ì„ ë‚˜ì˜¤ë©´ ê·¸ ë°©ì€ ìë™ìœ¼ë¡œ ì‚­ì œëœë‹¤.
2. ìºë¦­í„° ìœ„ì¹˜ ì—…ë°ì´íŠ¸
  - ìºë¦­í„°ì˜ ìœ„ì¹˜ëŠ” ì„œë²„ì—ì„œ ì €ì¥í•˜ê³ , ìœ ì €ì˜ ì†ë ¥ê³¼ ë°©í–¥ì— ë”°ë¼ì„œ 0.2ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸í•œë‹¤.
  - í´ë¼ì´ì–¸íŠ¸ì—ì„œ 1/30ì´ˆ ë§ˆë‹¤ ì„œë²„ì—ê²Œ ì…ë ¥ëœ ìœ ì €ì˜ ë°©í–¥ì„ ì•Œë ¤ì¤€ë‹¤.
  - ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•´ë‹¹ ì •ë³´ë¥¼ ë°›ìœ¼ë©´ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ë¶€í„° í˜„ì¬ê¹Œì§€ ì´ë™í•œ ê±°ë¦¬ë¥¼ ê¸°ì¡´ì˜ ë°©í–¥ëŒ€ë¡œ êµ¬í•´ í˜„ì¬ ìœ„ì¹˜ë¥¼ ì €ì¥í•œ ë’¤, ì „ë‹¬ë°›ì€ ë°©í–¥ì„ ë®ì–´ì”Œìš´ë‹¤.
  - ê·¸ë¦¬ê³  í•´ë‹¹ ìœ ì €ê°€ ìˆëŠ” ë°© ì•ˆì˜ ëª¨ë“  ìœ ì €ì˜ ìœ„ì¹˜ë¥¼ ì¶”ì¸¡í•­ë²•ìœ¼ë¡œ ì˜ˆì¸¡í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì— ë³´ë‚¸ë‹¤.
  - ì´ë•Œ ì¶”ì¸¡í•­ë²•ì— ì‚¬ìš©ë˜ëŠ” ë ˆì´í„´ì‹œëŠ” 1ì´ˆë§ˆë‹¤ ë³´ë‚´ëŠ” í•‘ì„ ì´ìš©í•´ì„œ ì¶”ì í•œ ì „ì²´ ê°’ ì¤‘ ê°€ì¥ í° ê°’ì„ ì‚¬ìš©í•œë‹¤.
  - í´ë¼ì´ì–¸íŠ¸ëŠ” ìœ ì €ë“¤ì˜ ìœ„ì¹˜ë¥¼ ë°›ì•„ í™”ë©´ì— ê·¸ë¦°ë‹¤.
  - ë‹¤ë¥¸ ìœ ì €ì˜ ê²½ìš°ì—ëŠ” ë°”ë¡œ ê·¸ ìœ„ì¹˜ë¡œ ë³´ì •í•˜ê³ , ìê¸° ìì‹ ì¼ ê²½ìš°ì—ëŠ” ì„ í˜• ë³´ê°„ìœ¼ë¡œ í•´ë‹¹ ìœ„ì¹˜ë¥¼ í–¥í•´ ì²œì²œíˆ ì´ë™í•˜ë„ë¡ í•œë‹¤.


## í”„ë¡œí† ë²„í”„

### Initial

#### ì„œë²„ ì ‘ì† (í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„)
``` proto
message InitialPayload {
  string deviceId = 1;      // ê¸°ê¸°ID 
  uint32 playerId = 2;      // í”Œë ˆì´ì–´ ID
  float latency = 3;        // ë ˆì´í„´ì‹œ
}
```

### Common

#### ê¸°ë³¸ íŒ¨í‚· êµ¬ì¡° (í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„)
``` proto
message CommonPacket {
  uint32 handlerId = 1;     // í•¸ë“¤ëŸ¬ ID (4ë°”ì´íŠ¸)
  string userId = 2;        // ìœ ì € ì•„ì´ë”” (uuid)
  string version = 3;       // í´ë¼ì´ì–¸íŠ¸ ë²„ì „
  bytes payload = 4;        // ì‹¤ì œ ë°ì´í„°
}
```

#### í•‘ íŒ¨í‚· êµ¬ì¡° (í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„)
``` proto
message Ping {
  int64 timestamp = 1;       // Ping íƒ€ì„ìŠ¤íƒ¬í”„
}
```
### Game

#### ê²Œì„ ìƒì„± (í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„)
``` proto
message CreateGamePayload {
  int64 timestamp = 1;       // ê²Œì„ ìƒì„± ì‹œê°
  uint32 playerId = 2;
  float speed = 3;
}
```

#### ê²Œì„ ì°¸ê°€ (í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„)
``` proto
message JoinGamePayload {
  string gameId = 1;         // ê²Œì„ ID (UUID)
  uint32 playerId = 2;       
  float speed = 3;
}
```

#### ìºë¦­í„° ë°©í–¥ ì•Œë¦¼ (í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„)
``` proto
message LocationUpdatePayload {
  string gameId = 1;
  float dx = 2;
  float dy = 3;
}
```

#### ê²Œì„ ì¢…ë£Œ (í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„)
``` proto
message EndGamePayload {
  string gameId = 1;
  float x = 2;
  float y = 3;
  uint32 score = 4;
  uint32 playerId = 5;
}
```

#### ê²Œì„ ì„¸ì…˜ ì •ë³´ (í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„)
``` proto
message GetAllGameSessionsPayload {
  int64 timestamp = 1;
}
```

#### ì—°ê²° í•´ì œ (í´ë¼ì´ì–¸íŠ¸ -> ì„œë²„)
``` proto
message DisConnectPacket {}
```

### Response

#### ì‘ë‹µ êµ¬ì¡° (ì„œë²„ -> í´ë¼ì´ì–¸íŠ¸)
``` proto
message Response {
  uint32 handlerId = 1;         // í•¸ë“¤ëŸ¬ ì•„ì´ë””(4ë°”ì´íŠ¸)
  uint32 responseCode = 2;      // ì‘ë‹µì½”ë“œ TODO
  uint64 timestamp = 3;         // íƒ€ì„ ìŠ¤íƒ¬í”„
  bytes data = 4;               // ì‹¤ì œ ë°ì´í„°
}
```

### Game Notification

#### ìœ ì €ë“¤ ìœ„ì¹˜ ì „ë‹¬ (ì„œë²„ -> í´ë¼ì´ì–¸íŠ¸)
``` proto
message LocationUpdate {
  repeated UserLocation users = 1;
}

message UserLocation {
    string id = 1;          // ìœ ì € ì•„ì´ë””
    uint32 playerId = 2;    // í”Œë ˆì´ì–´ ì•„ì´ë””(ì¢…ë¥˜)
    float x = 3;            // x ì¢Œí‘œ
    float y = 4;            // y ì¢Œí‘œ
}
```


## íŒŒì¼ ì •ë¦¬

```
ğŸ“¦src
 â”£ ğŸ“‚classes
 â”ƒ â”£ ğŸ“‚managers
 â”ƒ â”ƒ â”£ ğŸ“œbase.manager.js
 â”ƒ â”ƒ â”— ğŸ“œinterval.manager.js
 â”ƒ â”— ğŸ“‚models
 â”ƒ â”ƒ â”£ ğŸ“œgame.class.js
 â”ƒ â”ƒ â”— ğŸ“œuser.class.js
 â”£ ğŸ“‚config
 â”ƒ â”— ğŸ“œconfig.js
 â”£ ğŸ“‚constants
 â”ƒ â”£ ğŸ“œenv.js
 â”ƒ â”£ ğŸ“œhandlerIds.js
 â”ƒ â”— ğŸ“œheader.js
 â”£ ğŸ“‚db
 â”ƒ â”£ ğŸ“‚migrations
 â”ƒ â”ƒ â”— ğŸ“œcreateSchemas.js
 â”ƒ â”£ ğŸ“‚sql
 â”ƒ â”ƒ â”— ğŸ“œuser_db.sql
 â”ƒ â”£ ğŸ“‚user
 â”ƒ â”ƒ â”£ ğŸ“œuser.db.js
 â”ƒ â”ƒ â”— ğŸ“œuser.queries.js
 â”ƒ â”— ğŸ“œdatabase.js
 â”£ ğŸ“‚events
 â”ƒ â”£ ğŸ“œonConnection.js
 â”ƒ â”£ ğŸ“œonData.js
 â”ƒ â”£ ğŸ“œonEnd.js
 â”ƒ â”— ğŸ“œonError.js
 â”£ ğŸ“‚handlers
 â”ƒ â”£ ğŸ“‚game
 â”ƒ â”ƒ â”£ ğŸ“œcreateGame.handler.js         // ê²Œì„ ìƒì„±
 â”ƒ â”ƒ â”£ ğŸ“œdisconnect.handler.js         // ì—°ê²° í•´ì œ
 â”ƒ â”ƒ â”£ ğŸ“œendGame.handler.js            // ê²Œì„ ì¢…ë£Œ
 â”ƒ â”ƒ â”£ ğŸ“œgetGameSessions.handler.js    // ê²Œì„ ì„¸ì…˜ ì •ë³´ ë°›ê¸°
 â”ƒ â”ƒ â”£ ğŸ“œjoinGame.handler.js           // ê²Œì„ ì°¸ê°€
 â”ƒ â”ƒ â”— ğŸ“œupdateLocation.handler.js     // ì…ë ¥ ì•Œë¦¼ & ì„¸ì…˜ ë‚´ ì „ì²´ ìœ ì € ì´ë™ ì •ë³´ ì–»ê¸°
 â”ƒ â”£ ğŸ“‚user
 â”ƒ â”ƒ â”— ğŸ“œinitial.handler.js
 â”ƒ â”— ğŸ“œindex.js
 â”£ ğŸ“‚init
 â”ƒ â”£ ğŸ“œassets.js
 â”ƒ â”£ ğŸ“œindex.js
 â”ƒ â”— ğŸ“œloadProtos.js
 â”£ ğŸ“‚protobuf  // í†µì‹  í˜ì´ë¡œë“œ ê·œì•½
 â”ƒ â”£ ğŸ“‚notification
 â”ƒ â”ƒ â”— ğŸ“œgame.notification.proto
 â”ƒ â”£ ğŸ“‚request
 â”ƒ â”ƒ â”£ ğŸ“œcommon.proto
 â”ƒ â”ƒ â”— ğŸ“œgame.proto
 â”ƒ â”£ ğŸ“‚response
 â”ƒ â”ƒ â”— ğŸ“œresponse.proto
 â”ƒ â”£ ğŸ“œinitial.proto
 â”ƒ â”— ğŸ“œpacketNames.js
 â”£ ğŸ“‚session
 â”ƒ â”£ ğŸ“œgame.session.js
 â”ƒ â”£ ğŸ“œsessions.js
 â”ƒ â”— ğŸ“œuser.session.js
 â”£ ğŸ“‚utils
 â”ƒ â”£ ğŸ“‚db
 â”ƒ â”ƒ â”— ğŸ“œtestConnection.js
 â”ƒ â”£ ğŸ“‚error
 â”ƒ â”ƒ â”£ ğŸ“œcustomError.js
 â”ƒ â”ƒ â”£ ğŸ“œerror.handler.js
 â”ƒ â”ƒ â”— ğŸ“œerrorCodes.js
 â”ƒ â”£ ğŸ“‚notification
 â”ƒ â”ƒ â”— ğŸ“œgame.notification.js
 â”ƒ â”£ ğŸ“‚parser
 â”ƒ â”ƒ â”— ğŸ“œpacketParser.js
 â”ƒ â”£ ğŸ“‚response
 â”ƒ â”ƒ â”— ğŸ“œcreateResponse.js
 â”ƒ â”£ ğŸ“œdateFormatter.js
 â”ƒ â”— ğŸ“œtransformCase.js
 â”— ğŸ“œserver.js
```

